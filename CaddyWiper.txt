                                                                                                                                  
  ,ad8888ba,                        88           88             I8,        8        ,8I  88                                       
 d8"'    `"8b                       88           88             `8b       d8b       d8'  ""                                       
d8'                                 88           88              "8,     ,8"8,     ,8"                                            
88             ,adPPYYba,   ,adPPYb,88   ,adPPYb,88  8b       d8  Y8     8P Y8     8P    88  8b,dPPYba,    ,adPPYba,  8b,dPPYba,  
88             ""     `Y8  a8"    `Y88  a8"    `Y88  `8b     d8'  `8b   d8' `8b   d8'    88  88P'    "8a  a8P_____88  88P'   "Y8  
Y8,            ,adPPPPP88  8b       88  8b       88   `8b   d8'    `8a a8'   `8a a8'     88  88       d8  8PP"""""""  88          
 Y8a.    .a8P  88,    ,88  "8a,   ,d88  "8a,   ,d88    `8b,d8'      `8a8'     `8a8'      88  88b,   ,a8"  "8b,   ,aa  88          
  `"Y8888Y"'   `"8bbdP"Y8   `"8bbdP"Y8   `"8bbdP"Y8      Y88'        `8'       `8'       88  88`YbbdP"'    `"Ybbd8"'  88          
                                                         d8'                                 88                                   
                                                        d8'                                  88                                   


https://securityintelligence.com/posts/caddywiper-malware-targeting-ukrainian-organizations/

Upon execution, CaddyWiper first executes “DsRoleGetPrimaryDomainInformation” to determine the machine role of the system the wiper is running on. If the domain role is “DsRole_RolePrimaryDomainController,” CaddyWiper terminates and does not continue with any destructive functions. According to the ESET, they observed CaddyWiper being deployed to target systems via a Domain Controller indicating the authors designed the wiper malware to be used in situations where the target’s Active Directory environment has been compromised.

...

If the target system is not a Domain Controller, CaddyWiper begins recursively wiping all data within “%SystemDrive%\Users” including hidden and operating system files. In the event a file is larger than 10 megabytes, the wiper destroys the first “40960” bytes. If a file is currently locked by another process, CaddyWiper first attempts to take ownership of the file via “SeTakeOwnershipPrivilege” and then resumes wiping the file.

https://docs.microsoft.com/en-us/windows/win32/api/dsrole/nf-dsrole-dsrolegetprimarydomaininformation

...

https://securityaffairs.co/wordpress/129069/cyber-warfare-2/caddywiper-wiper-hits-ukraine.html

Similar to HermeticWiper deployments, CaddyWiper being deployed via GPO, a circumstance that suggests the attackers had initially compromised the target’s Active Directory server.

https://docs.microsoft.com/en-us/troubleshoot/windows-server/group-policy/use-group-policy-to-install-software

...

https://www.truesec.com/hub/blog/analysis-of-caddywiper-wiper-targeting-ukraine

Lastly the wiper loops through a list of open raw access to \\\\.\\PHYSICALDRIVE9 - \\\\.\\PHYSICALDRIVE0 and writing to it using IOCTL_DISK_SET_DRIVE_LAYOUT_EX (0x7c054) by using the API DeviceIoControl. By doing so it erases the Master Boot Record.



EOF